<div id="Zauberberg">
    <script>
        /**
         * Generell
         */

        addListener('START', function (event) {
            var stringFromServer = event.data;
            if (stringFromServer === "HOST") {
                document.getElementById("closeButton").style.visibility = "visible";
                document.getElementById("overlayMsg").style.visibility = "visible";
                document.getElementById("overlayMsg").innerHTML = "<p>Du bist der Host. Wenn alle Spieler bereit sind, musst du das Spiel starten.</p>" +
                    "<button id=\"startButton\" class=\"button\" onclick=\"startGame()\">Spiel starten</button>";
            } else {
                document.getElementById("closeButton").style.visibility = "hidden";
                document.getElementById("overlayMsg").style.visibility = "visible";
                document.getElementById("overlayMsg").innerHTML = "Warte auf das Startsignal vom Host";
            }
        });

        addListener('STARTGAME', function (event) {
            document.getElementById("overlayMsg").style.visibility = "hidden";
        });

        addListener('CLOSE', function (event) {
            document.getElementById("overlayMsg").innerHTML = event.data;
            document.getElementById("overlayMsg").style.visibility = "visible";
        });

        function startGame() {
            sendDataToServer("START");
        }

        function closeGame() {
            sendDataToServer("CLOSE");
        }
    </script>
    <div id="Spielfeld">
        <div id="grid">
            <table id="Tabelle_01" width="770" height="770" border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_01.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_02.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_03.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_04.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_05.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_06.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_07.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_08.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_09.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_10.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_11.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_12.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_13.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_14.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_15.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_16.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_17.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_18.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_19.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_20.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_21.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_22.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_23.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_24.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_25.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_26.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_27.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_28.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_29.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_30.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_31.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_32.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_33.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_34.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_35.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_36.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_37.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_38.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_39.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_40.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_41.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_42.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_43.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_44.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_45.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_46.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_47.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_48.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_49.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_50.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_51.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_52.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_53.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_54.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_55.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_56.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_57.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_58.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_59.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_60.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_61.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_62.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_63.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_64.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_65.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_66.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_67.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_68.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_69.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_70.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_71.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_72.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_73.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_74.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_75.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_76.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_77.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_78.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_79.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_80.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_81.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_82.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_83.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_84.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_85.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_86.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_87.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_88.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_89.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_90.gif" width="77" height="77" alt=""></td>
                </tr>
                <tr>
                    <td>
                        <img src="layout_images/layoutnew_91.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_92.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_93.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_94.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_95.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_96.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_97.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_98.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_99.gif" width="77" height="77" alt=""></td>
                    <td>
                        <img src="layout_images/layoutnew_100.png" width="77" height="77" alt=""></td>
                </tr>
            </table>
        </div>
    </div>
    <script>
        /**
         * Spielfeld
         */

        function kristallkugel() {
            //todo wird aufgerufen, wenn das Ereignis auftritt und der Spieler die Karten zum Aufdecken wählt
        }

        /* BEISPIEL TICTACTOE
        var emptyImg = "/Zauberberg/images/empty.png";
        var xImg = "/Zauberberg/images/x.jpg";
        var oImg = "/Zauberberg/images/o2.png";
        var statusWait = true;

        var arrFields = [0, 0, 0, 0, 0, 0, 0, 0, 0];
        var sentFields = [0, 0, 0, 0, 0, 0, 0, 0, 0];

        function setField(x) {
            sentFields[x] = 1;
        }

        function getImg(x) {
            if (x == 1) return xImg;
            else if (x == 2) return oImg;
            return emptyImg
        }

        function initFields() {
            var parent = document.getElementById("grid");
            for (var i = 0; i < 9; i++) {
                var img = document.createElement("img");
                img.id = "img" + i;
                img.src = emptyImg;
                img.width = "148";
                img.height = "153";
                img.style.position = "absolute";
                img.style.top = (Math.floor((i / 3)) * 172 + 11) + "px";
                img.style.left = ((i % 3) * 170 + 11) + "px";
                img.onclick = function () {
                    if (arrFields[this.id[3]] == 0 && statusWait == false) {
                        setField(this.id[3]);
                        updateGameState();
                    }
                };
                parent.appendChild(img);
            }
        }

        window.onload = initFields;

        function redraw() {
            for (var i = 0; i < 9; i++) {
                var img = document.getElementById('img' + i);
                img.src = getImg(arrFields[i]);
            }
        }

        */
    </script>

    <!-- START Aktionsfläche -->
    <div id="Aktionsfläche">
        <div id="GameControl">
            <button id="closeButton" class="button" onclick="closeGame()" style="visibility: hidden">Beenden</button>
        </div>
        <table id="Spielzustand">
            <tr id="SpielerRot">
                <td><span class="spielername" style="color: #EF5350">Rot</span></td>
                <td><img id="RotStein1" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="RotStein2" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="RotRabe1" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="RotRabe2" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="RotRabe3" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="RotRabeAktion" src="images/x.jpg" onclick="selectRabeAction('Rot')" class="rabeBtn"/></td>
            </tr>
            <tr id="SpielerBlau">
                <td><span class="spielername" style="color: #42A5F5">Blau </span></td>
                <td><img id="BlauStein1" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="BlauStein2" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="BlauRabe1" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="BlauRabe2" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="BlauRabe3" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="BlauRabeAktion" src="images/x.jpg" onclick="selectRabeAction('Blau')" class="rabeBtn"/>
                </td>
            </tr>
            <tr id="SpielerGrün">
                <td><span class="spielername" style="color: #66BB6A">Grün</span></td>
                <td><img id="GrünStein1" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="GrünStein2" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="GrünRabe1" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GrünRabe2" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GrünRabe3" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GrünRabeAktion" src="images/x.jpg" onclick="selectRabeAction('Grün')" class="rabeBtn"/>
                </td>
            </tr>
            <tr id="SpielerGelb">
                <td><span class="spielername" style="color: #FFEE58">Gelb</span></td>
                <td><img id="GelbStein1" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="GelbStein2" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="GelbRabe1" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GelbRabe2" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GelbRabe3" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GelbRabeAktion" src="images/x.jpg" onclick="selectRabeAction('Gelb')" class="rabeBtn"/>
                </td>
            </tr>
            <tr id="SpielerGrau">
                <td><span class="spielername" style="color: #BDBDBD">Grau</span></td>
                <td><img id="GrauStein1" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="GrauStein2" src="images/x.jpg" class="spielzustandStein"/></td>
                <td><img id="GrauRabe1" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GrauRabe2" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GrauRabe3" src="images/o2.png" class="spielzustandStein"/></td>
                <td><img id="GrauRabeAktion" src="images/x.jpg" onclick="selectRabeAction('Grau')" class="rabeBtn"/>
                </td>
            </tr>
        </table>
        <div id="textInfo">
            <p id="textInfo1">___________________________________________________________________________</p>
            <p id="textInfo2">___________________________________________________________________________</p>
            <p id="textInfo3">___________________________________________________________________________</p>
            <p id="textInfo4">___________________________________________________________________________</p>
            <p id="textInfo5">___________________________________________________________________________</p>
        </div>
        <div id="karten-Hand" class="kartenliste" style="display: block">
            <div class="karte"><img src="/Zauberberg/images/Zahlenkarte1.png" class="karteBild" alt="1"/></div>
            <div class="karte"><img src="/Zauberberg/images/Zahlenkarte2.png" class="karteBild" alt="2"/></div>
            <div class="karte"><img src="/Zauberberg/images/Zahlenkarte3.png" class="karteBild" alt="3"/></div>
        </div>
        <div style="position: relative; width: 800px; border-top: solid 1px #555555; border-bottom: solid 1px #555555;">
            <div id="karten-Legen" class="kartenliste">
                <div class="karte"><img src="/Zauberberg/images/Zahlenkarte1.png" class="karteBild" alt="1"/></div>
                <div class="karte"><img src="/Zauberberg/images/Zahlenkarte2.png" class="karteBild" alt="2"/></div>
                <div class="karte"><img src="/Zauberberg/images/Zahlenkarte3.png" class="karteBild" alt="3"/></div>
            </div>
            <button id="kartenLegenBtn" class="button" onclick="kartenLegenBtnAction()">
                Karten legen
            </button>
        </div>
        <div style="position: relative; width: 800px">
            <div id="karten-Tauschen" class="kartenliste">
                <div class="karte"><img src="/Zauberberg/images/Zahlenkarte1.png" class="karteBild" alt="1"/></div>
                <div class="karte"><img src="/Zauberberg/images/Zahlenkarte2.png" class="karteBild" alt="2"/></div>
                <div class="karte"><img src="/Zauberberg/images/Zahlenkarte3.png" class="karteBild" alt="3"/></div>
                <div id="joker0" class="karte jokerkarte" data-jokervalue="1">
                    <img id="joker0_1" src="/Zauberberg/images/Zahlenkarte1.png" class="joker"
                         onclick="jokerSet(0, 1)" style="opacity: 1;"/>
                    <img id="joker0_2" src="/Zauberberg/images/Zahlenkarte2.png" class="joker"
                         onclick="jokerSet(0, 2)" style="opacity: 0.2;"/>
                    <img id="joker0_3" src="/Zauberberg/images/Zahlenkarte3.png" class="joker"
                         onclick="jokerSet(0, 3)" style="opacity: 0.2;"/>
                    <img id="joker0_4" src="/Zauberberg/images/Zahlenkarte4.png" class="joker"
                         onclick="jokerSet(0, 4)" style="opacity: 0.2;"/>
                    <img id="joker0_5" src="/Zauberberg/images/Zahlenkarte5.png" class="joker"
                         onclick="jokerSet(0, 5)" style="opacity: 0.2;"/>
                </div>
            </div>
            <button id="kartenTauschenBtn" class="button" onclick="kartenTauschenBtnAction()">
                Karten tauschen
            </button>
        </div>
    </div>
    <script>    /** Javascript für die Aktionsfläche (Zauberberg.js wird durch Serverfehler nicht geladen!) */
    Sortable.create(document.getElementById("karten-Hand"), {
        group: {name: "karten", put: true, pull: true},
        draggable: 'div',
        animation: 150
    });
    Sortable.create(document.getElementById("karten-Legen"), {
        group: {
            name: "karten",
            put: function () {
                return (!ereignisFliegendeKarte && (document.getElementById("karten-Legen").childElementCount < 3)) ||
                    (ereignisFliegendeKarte && (document.getElementById("karten-Legen").childElementCount < ereignisFliegendeKarteRestlicheZuege));
            },
            pull: function () {
                return (document.getElementById("karten-Legen").childElementCount > 2) || ereignisFliegendeKarte;
            }
        },
        draggable: 'div',
        animation: 150
    });
    Sortable.create(document.getElementById("karten-Tauschen"), {
        group: {name: "karten", put: true, pull: true},
        draggable: 'div',
        animation: 150
    });

    function kartenLegenBtnAction() {
        disableKartenLegen(true);
        disableKartenTauschen(true);
        var output = {};
        if (ereignisFliegendeKarte) {
            output = {
                "Eventname": "EREIGNISANTWORT",
                "Ereignis": "Fliegende Karte",
                "karte1Typ": "Null",
                "karte2Typ": "Null",
                "karte1Wert": "Null",
                "karte2Wert": "Null"
            };
            ereignisFliegendeKarte = false;
        } else {
            output = {
                "Eventname": "KARTENLEGEN",
                "karte1Typ": "Null",
                "karte2Typ": "Null",
                "karte3Typ": "Null",
                "karte1Wert": "Null",
                "karte2Wert": "Null",
                "karte3Wert": "Null"
            };
        }
        var kartencontainer = document.getElementById("karten-Legen");
        //console.log(kartencontainer); // LOG
        for (var i = 0; i < kartencontainer.childElementCount; i++) {
            if (kartencontainer.children[i].classList.contains("jokerkarte")) { // Ist ein Joker
                output["karte" + (i + 1) + "Typ"] = "Joker";
                output["karte" + (i + 1) + "Wert"] = kartencontainer.children[i].getAttribute("data-jokervalue");
            } else { // Ist normale Karte
                output["karte" + (i + 1) + "Typ"] = "Normal";
                output["karte" + (i + 1) + "Wert"] = kartencontainer.children[i].children[0].alt;
            }
        }
        console.log(output);
        sendDataToServer(JSON.stringify(output));
    }

    function kartenTauschenBtnAction() {
        disableKartenLegen(true);
        disableKartenTauschen(true);
        var output = {
            "Eventname": "KARTENTAUSCHEN",
            "karte1": "Null",
            "karte2": "Null",
            "karte3": "Null",
            "karte4": "Null",
            "karte5": "Null"
        };
        var kartencontainer = document.getElementById("karten-Tauschen");
        //console.log(kartencontainer); // LOG
        for (var i = 0; i < kartencontainer.childElementCount; i++) {
            if (kartencontainer.children[i].classList.contains("jokerkarte")) { // Ist ein Joker
                output["karte" + (i + 1)] = "Joker";
            } else { // Ist normale Karte
                output["karte" + (i + 1)] = kartencontainer.children[i].children[0].alt;
            }
        }
        console.log(output);
        console.log(JSON.stringify(output));
        sendDataToServer(JSON.stringify(output));
    }

    function disableKartenLegen(disable) {
        if (disable) {
            document.getElementById("kartenLegenBtn").classList.add("buttondisabled");
        } else {
            document.getElementById("kartenLegenBtn").classList.remove("buttondisabled");
        }
    }

    function disableKartenTauschen(disable) {
        if (disable) {
            document.getElementById("kartenTauschenBtn").classList.add("buttondisabled");
        } else {
            document.getElementById("kartenTauschenBtn").classList.remove("buttondisabled");
        }
    }

    function jokerSet(jokerID, value) {
        document.getElementById("joker" + jokerID + "_" + 1).style.opacity = "0.2";
        document.getElementById("joker" + jokerID + "_" + 2).style.opacity = "0.2";
        document.getElementById("joker" + jokerID + "_" + 3).style.opacity = "0.2";
        document.getElementById("joker" + jokerID + "_" + 4).style.opacity = "0.2";
        document.getElementById("joker" + jokerID + "_" + 5).style.opacity = "0.2";
        document.getElementById("joker" + jokerID + "_" + value).style.opacity = "1";

        document.getElementById("joker" + jokerID).setAttribute("data-jokervalue", value.toString());

        // document.getElementById("joker" + jokerID + "_" + 1).classList.remove("chosenJoker");
        // document.getElementById("joker" + jokerID + "_" + 3).classList.remove("chosenJoker"); todo remove old when alternative works
        // document.getElementById("joker" + jokerID + "_" + 2).classList.remove("chosenJoker");
        // document.getElementById("joker" + jokerID + "_" + 4).classList.remove("chosenJoker");
        // document.getElementById("joker" + jokerID + "_" + 5).classList.remove("chosenJoker");
        // document.getElementById("joker" + jokerID + "_" + value).classList.add("chosenJoker");
    }

    addListener('UPDATESPIELZUSTAND', function (event) {
        var stringFromServer = event.data;
        var data = JSON.parse(stringFromServer);
        //var kartencontainer = document.getElementById("karten-Hand");
        for (var colour in data) {
            if (data[colour]["Aktiv"] === "1") {
                document.getElementById("Spieler" + colour).style.visibility = "visible";

                if (data[colour]["Fokus"] === "1") {
                    document.getElementById("Spieler" + colour).children[0].style.textDecoration = "underline solid white";
                } else {
                    document.getElementById("Spieler" + colour).children[0].style.textDecoration = "";
                }

                if (data[colour]["Steine"] === "2") {
                    document.getElementById(colour + "Stein1").style.visibility = "visible";
                    document.getElementById(colour + "Stein2").style.visibility = "visible";
                    document.getElementById(colour + "Rabe1").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe3").style.visibility = "hidden";
                } else if (data[colour]["Steine"] === "1") {
                    document.getElementById(colour + "Stein1").style.visibility = "visible";
                    document.getElementById(colour + "Stein2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe1").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe3").style.visibility = "hidden";
                } else if (data[colour]["Steine"] === "0") {
                    document.getElementById(colour + "Stein1").style.visibility = "hidden";
                    document.getElementById(colour + "Stein2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe1").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe3").style.visibility = "hidden";
                } else if (data[colour]["Steine"] === "-1") {
                    document.getElementById(colour + "Stein1").style.visibility = "hidden";
                    document.getElementById(colour + "Stein2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe1").style.visibility = "visible";
                    document.getElementById(colour + "Rabe2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe3").style.visibility = "hidden";
                } else if (data[colour]["Steine"] === "-2") {
                    document.getElementById(colour + "Stein1").style.visibility = "hidden";
                    document.getElementById(colour + "Stein2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe1").style.visibility = "visible";
                    document.getElementById(colour + "Rabe2").style.visibility = "visible";
                    document.getElementById(colour + "Rabe3").style.visibility = "hidden";
                } else if (data[colour]["Steine"] === "-3") {
                    document.getElementById(colour + "Stein1").style.visibility = "hidden";
                    document.getElementById(colour + "Stein2").style.visibility = "hidden";
                    document.getElementById(colour + "Rabe1").style.visibility = "visible";
                    document.getElementById(colour + "Rabe2").style.visibility = "visible";
                    document.getElementById(colour + "Rabe3").style.visibility = "visible";
                }
                if (data[colour]["BistDu"] === "1") {
                    document.getElementById("Spieler" + colour).children[0].style.fontWeight = "bold";
                } else {
                    document.getElementById("Spieler" + colour).children[0].style.fontWeight = "inherit";
                }
            } else {
                document.getElementById("Spieler" + colour).style.visibility = "hidden";
            }
        }
    });

    addListener('UPDATEKARTEN', function (event) {
        disableKartenLegen(false);
        disableKartenTauschen(false);
        if (ereignisFliegendeKarte) {
            disableKartenTauschen(true);
        }
        var stringFromServer = event.data;
        var arr = JSON.parse(stringFromServer);
        document.getElementById("karten-Legen").innerHTML = "";
        document.getElementById("karten-Tauschen").innerHTML = "";
        var kartencontainer = document.getElementById("karten-Hand");
        kartencontainer.innerHTML = "";
        var jokercount = 0;
        arr.forEach(function (kartenWert) {
            if (kartenWert === "Joker") {
                var jokerkarte = "<div id=\"joker" + jokercount + "\" class=\"karte jokerkarte\" data-jokervalue=\"1\">";
                for (var i = 1; i <= 5; i++) {
                    jokerkarte += "<img id=\"joker" + jokercount + "_" + i + "\" src=\"/Zauberberg/images/Zahlenkarte" + i + ".png\" class=\"joker\"" +
                        " onclick=\"jokerSet(" + jokercount + ", " + i + ")\" style=\"opacity: " + (i === 1 ? "1" : "0.2") + ";\"/>";
                }
                jokerkarte += "</div>";
                kartencontainer.append(jokerkarte);
                jokercount++;
            } else {
                kartencontainer.append("<img src='/Zauberberg/images/Zahlenkarte" + zahl + ".png' class='karte' alt='" + zahl + "'/>");// Der Zahlenwert wird im "alt" gespeichert
            }
        });
    });

    addListener("PUSHINFOTXT", function (event) {
        var stringFromServer = event.data;
        var text1 = document.getElementById("textInfo1");
        var text2 = document.getElementById("textInfo2");
        var text3 = document.getElementById("textInfo3");
        var text4 = document.getElementById("textInfo4");
        var text5 = document.getElementById("textInfo5");
        text1.innerText = text2.innerText;
        text2.innerText = text3.innerText;
        text3.innerText = text4.innerText;
        text4.innerText = text5.innerText;
        text5.innerText = stringFromServer;
    });

    var ereignisFliegendeKarte = false;
    var ereignisFliegendeKarteRestlicheZuege = 1;

    addListener("EREIGNISANFRAGE", function (event) {
        var stringFromServer = event.data;
        var data = JSON.parse(stringFromServer);
        if (data["Ereignis"] === "Kristallkugel") {
            kristallkugel();
        } else if (data["Ereignis"] === "Fliegende Karte") {
            ereignisFliegendeKarte = true;
            ereignisFliegendeKarteRestlicheZuege = parseInt(data["RestlicheZuege"]);
        } else if (data["Ereignis"] === "Rabe") {
            var btns = document.getElementsByClassName("rabeBtn");
            for (var i = 0; i < btns.length; i++) {
                btns[i].style.visibility = "visible";
            }
        }
    });

    function selectRabeAction(colour) {
        var btns = document.getElementsByClassName("rabeBtn");
        for (var i = 0; i < btns.length; i++) {
            btns[i].style.visibility = "hidden";
        }
        var output = {
            "Eventname": "EREIGNISANTWORT",
            "Ereignis": "Rabe",
            "Spieler": colour
        };
        sendDataToServer(JSON.stringify(output));
    }
    </script>
    <!-- ENDE Aktionsfläche -->
</div>

<span id="overlayMsg">Warte auf Mitspieler...</span>
<!-- Diese Javascript Zeile ist nur für die Entwicklung da, damit der Overlay nicht stört -->
<script>document.getElementById("overlayMsg").style.visibility = "hidden";</script>